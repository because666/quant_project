# 项目文件功能规范说明书

## 1. 概述
本说明书旨在明确量化选股项目中各代码文件的技术职责、功能规范及交互接口。所有开发工作需严格遵循此规范，以确保模块间有效集成与系统稳定运行。

## 2. 数据模块 (Data Module)

### 2.1 `data_fetcher.py`
**核心职责**：实现从指定数据源获取原始证券交易数据。
- **输入**：证券代码列表、起始日期、结束日期（默认从`project_config.py`读取）。
- **输出**：写入`data_module/outputs/raw_data.parquet`文件。
- **关键功能**：
  1. 调用AKShare或Tushare等数据接口，获取日级K线数据。
  2. 实现网络请求异常处理与重试机制。
  3. 数据字段需包含：日期(`date`)、证券代码(`symbol`)、开盘价(`open`)、最高价(`high`)、最低价(`low`)、收盘价(`close`)、成交量(`volume`)。
  4. 将不同证券的数据合并为单一结构化数据集。

### 2.2 `data_cleaner.py`
**核心职责**：对原始数据进行清洗与标准化处理。
- **输入**：读取`data_module/outputs/raw_data.parquet`。
- **输出**：写入`data_module/outputs/standard_data.parquet`文件。
- **关键功能**：
  1. 检测并处理缺失值（标记或填充）。
  2. 识别并处理价格、成交量的极端异常值。
  3. 统一日期时间格式，并按证券代码、日期进行排序。
  4. 确保所有数值字段格式正确。

### 2.3 `factor_miner.py`
**核心职责**：基于标准化数据计算量化因子。
- **输入**：读取`data_module/outputs/standard_data.parquet`。
- **输出**：扩展并更新`data_module/outputs/standard_data.parquet`，增加因子列。
- **关键功能**：
  1. 计算技术指标因子，如简单收益率、移动平均、波动率。
  2. 预留接口用于整合基本面因子与情绪因子。
  3. 输出的因子列需有明确命名（如`return_5d`、`ma_20`）。

## 3. 策略模块 (Strategy Module)

### 3.1 `model_trainer.py`
**核心职责**：训练用于预测价格走势的机器学习模型。
- **输入**：读取含因子列的`standard_data.parquet`，参数从`strategy_params.yaml`读取。
- **输出**：写入`strategy_module/outputs/trained_model.pkl`模型文件。
- **关键功能**：
  1. 划分训练集与测试集（按时间序列划分）。
  2. 实现特征工程与标签定义（如未来N日涨跌分类）。
  3. 集成多种机器学习算法（逻辑回归、随机森林、XGBoost）进行训练。
  4. 输出模型性能评估报告。

### 3.2 `factor_optimizer.py`
**核心职责**：评估因子有效性并进行筛选优化。
- **输入**：读取因子数据与模型。
- **输出**：因子重要性排名报告。
- **关键功能**：
  1. 计算因子信息系数（IC）等统计指标。
  2. 基于模型内建方法（如feature_importances_）评估因子重要性。
  3. 输出建议保留的因子清单。

### 3.3 `strategy_engine.py`
**核心职责**：加载训练好的模型并生成交易信号。
- **输入**：读取`trained_model.pkl`与最新的因子数据。
- **输出**：写入`strategy_module/outputs/signal.csv`文件。
- **关键功能**：
  1. 加载模型并对新数据执行预测。
  2. 根据预测概率或数值生成离散交易信号（1：买入，-1：卖出，0：持有）。
  3. 信号文件须包含日期(`date`)、证券代码(`symbol`)、信号(`signal`)三列。

## 4. 回测模块 (Backtest Module)

### 4.1 `backtest_engine.py`
**核心职责**：模拟交易过程，计算模拟持仓与资金曲线。
- **输入**：读取`signal.csv`、价格数据、`user_portfolio.json`（初始账户）。
- **输出**：包含每日账户市值、持仓明细、交易记录的结构化数据。
- **关键功能**：
  1. 模拟A股T+1交易制度与涨跌停板限制。
  2. 执行买卖撮合逻辑，计算交易成本。
  3. 实时计算并更新账户总资产与持仓市值。

### 4.2 `performance_analyzer.py`
**核心职责**：计算投资组合绩效评价指标。
- **输入**：读取`backtest_engine.py`输出的资金曲线与交易记录。
- **输出**：绩效指标字典。
- **关键功能**：
  1. 计算年化收益率、波动率、夏普比率。
  2. 计算最大回撤及其持续期。
  3. 计算胜率、盈亏比等交易层面指标。

### 4.3 `report_generator.py`
**核心职责**：生成可视化回测报告与操作建议。
- **输入**：绩效指标与回测详细数据。
- **输出**：HTML/PDF格式的可视化报告文件，及文本版操作建议。
- **关键功能**：
  1. 绘制资金曲线、回撤曲线、月度收益热力图。
  2. 生成结构化文本，总结历史表现并给出未来1-3个交易日的具体操作建议（标的、方向、建议仓位）。

### 4.4 `user_portfolio.json`
**核心职责**：定义回测或模拟交易的初始状态。
- **内容**：初始资金额度、初始持有的证券代码及数量。
- **功能**：为回测引擎提供起始点，支持从特定持仓状态开始回测。

## 5. 配置与串联模块 (Configuration & Integration Module)

### 5.1 配置目录 (`config/`)
- **`api_config.yaml`**：存储所有外部数据服务（如Tushare、聚宽）的访问密钥与端点URL。
- **`project_config.py`**：定义项目级全局常量，包括但不限于：`STOCK_POOL`（股票池）、`START_DATE`（数据开始日期）、`END_DATE`（回测结束日期）、`INITIAL_CAPITAL`（初始资金）、`DATA_PATH`（数据存储根路径）。
- **`strategy_params.yaml`**：定义策略级可变参数，包括：`MODEL_NAME`（选用模型）、`FACTOR_WEIGHTS`（因子权重字典）、`STOP_LOSS`（止损比例）、`TAKE_PROFIT`（止盈比例）。

### 5.2 主应用目录 (`main_app/`)
- **`main_pipeline.py`**：定义并执行项目核心工作流，顺序调用数据获取、清洗、因子计算、模型预测、回测、报告生成等环节。
- **`data_interface.py`**：为其他模块提供统一、安全的数据访问接口函数，如`get_clean_data()`，隐藏底层文件路径细节。
- **`risk_manager.py`**：独立的风险监控与执行单元。持续监控市场指数（如沪深300）与预设风控规则（如均线），在触发条件时发送清仓指令。
- **`gui_controller.py`**：作为后端逻辑与前端界面的桥梁，将前端用户操作（如点击按钮）映射到对应的后台函数调用。

### 5.3 前端界面目录 (`frontend/`)
- **`main_window.py`**：应用程序主窗口的布局定义，集成各功能面板。
- **`config_panel.py`**：提供图形化控件（如下拉框、滑动条、输入框）供用户修改`project_config.py`与`strategy_params.yaml`中的参数。
- **`strategy_panel.py`**：提供模型选择、因子权重调整等策略配置的交互界面。
- **`result_panel.py`**：负责展示回测报告图表与文本，并提供报告导出功能。

### 5.4 工具目录 (`main_app/utils/`)
- **`logger.py`**：实现项目统一的日志记录功能，配置日志级别与输出格式。
- **`exception_handler.py`**：实现全局异常捕获与用户友好的错误提示。
- **`file_io.py`**：封装常见的文件读写操作，确保格式兼容性（CSV, Parquet, JSON）。

### 5.5 根目录文件
- **`main.py`**：程序主入口点。负责初始化环境，并启动图形用户界面或指定的命令行工作流。
- **`requirements.txt`**：项目所依赖的第三方Python包及其精确版本列表。

---
**文档版本**：1.0  
**最后更新**：2025.12.20 
**使用说明**：所有开发人员需确保其实现的功能与此说明书定义保持一致。任何对接口或功能的修改需同步更新此文档并经组长确认。


